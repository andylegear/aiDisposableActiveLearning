{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DSQI Evaluation Result",
  "description": "Schema for a single DSQI evaluation of a disposable software artifact. Corresponds to Layer 1 of the three-layer evaluation protocol.",
  "type": "object",
  "required": ["artifact_id", "evaluator", "date", "maintenance_cost", "creation_cost", "pedagogical_alignment", "pedagogical_purity", "weights", "dsqi_score"],
  "properties": {
    "artifact_id": { "type": "integer", "minimum": 1, "maximum": 5 },
    "artifact_slug": { "type": "string" },
    "evaluator": { "type": "string", "description": "Name or ID of evaluator (self for Layer 1)" },
    "date": { "type": "string", "format": "date" },
    "notes": { "type": "string" },

    "maintenance_cost": {
      "type": "object",
      "description": "M: Maintenance Cost Score. Lower is better (inverted in DSQI formula).",
      "properties": {
        "dependency_count": { "type": "integer", "description": "Number of runtime dependencies" },
        "dependency_count_normalized": { "type": "number", "minimum": 0, "maximum": 1 },
        "cyclomatic_complexity_avg": { "type": "number", "description": "Average cyclomatic complexity across functions" },
        "cyclomatic_complexity_normalized": { "type": "number", "minimum": 0, "maximum": 1 },
        "deployment_steps": { "type": "integer", "description": "Number of manual steps required to deploy" },
        "deployment_steps_normalized": { "type": "number", "minimum": 0, "maximum": 1 },
        "M_score": { "type": "number", "minimum": 0, "maximum": 1, "description": "Composite maintenance cost (average of normalized sub-metrics)" }
      }
    },

    "creation_cost": {
      "type": "object",
      "description": "C: Creation Cost Score. Lower is better (inverted in DSQI formula).",
      "properties": {
        "lines_of_code": { "type": "integer", "description": "Total lines of code (from cloc)" },
        "lines_of_code_normalized": { "type": "number", "minimum": 0, "maximum": 1 },
        "ai_generation_ratio": { "type": "number", "minimum": 0, "maximum": 1, "description": "Proportion of code generated by AI (self-reported)" },
        "development_time_minutes": { "type": "integer" },
        "development_time_normalized": { "type": "number", "minimum": 0, "maximum": 1 },
        "C_score": { "type": "number", "minimum": 0, "maximum": 1, "description": "Composite creation cost" }
      }
    },

    "pedagogical_alignment": {
      "type": "object",
      "description": "P: Pedagogical Alignment Score. Higher is better.",
      "properties": {
        "concept_coverage": { "type": "number", "minimum": 0, "maximum": 1, "description": "Proportion of target learning objective sub-concepts addressed" },
        "icap_level": {
          "type": "string",
          "enum": ["passive", "active", "constructive", "interactive"],
          "description": "Highest ICAP engagement level the tool is designed to elicit"
        },
        "icap_score": { "type": "number", "minimum": 0, "maximum": 1, "description": "Normalized ICAP score: passive=0.25, active=0.5, constructive=0.75, interactive=1.0" },
        "P_score": { "type": "number", "minimum": 0, "maximum": 1, "description": "Composite pedagogical alignment (average of sub-metrics)" }
      }
    },

    "pedagogical_purity": {
      "type": "object",
      "description": "E: Pedagogical Purity Score (revised). Higher is better.",
      "properties": {
        "conceptual_fidelity_raw": { "type": "integer", "minimum": 1, "maximum": 5 },
        "conceptual_fidelity_normalized": { "type": "number", "minimum": 0, "maximum": 1, "description": "(raw - 1) / 4" },
        "process_replicability_raw": { "type": "integer", "minimum": 1, "maximum": 5 },
        "process_replicability_normalized": { "type": "number", "minimum": 0, "maximum": 1, "description": "(raw - 1) / 4" },
        "E_score": { "type": "number", "minimum": 0, "maximum": 1, "description": "Average of E1 and E2 normalized" }
      }
    },

    "weights": {
      "type": "object",
      "description": "Weights used in DSQI formula. Must sum to 1.0.",
      "properties": {
        "w1_maintenance": { "type": "number", "default": 0.3 },
        "w2_creation": { "type": "number", "default": 0.2 },
        "w3_pedagogical": { "type": "number", "default": 0.3 },
        "w4_purity": { "type": "number", "default": 0.2 }
      }
    },

    "dsqi_score": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Final DSQI = w1*(1-M) + w2*(1-C) + w3*P + w4*E"
    },

    "raw_metrics": {
      "type": "object",
      "description": "Raw data collected automatically by dsqi_collect.py. Preserved for auditability.",
      "properties": {
        "collected_at": { "type": "string", "format": "date-time" },
        "collector_version": { "type": "string" },
        "cloc": {
          "type": "object",
          "description": "Full cloc output (per-language breakdown)",
          "additionalProperties": true
        },
        "complexity": {
          "type": "object",
          "description": "Per-file cyclomatic complexity data",
          "properties": {
            "tool": { "type": "string" },
            "files": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "file": { "type": "string" },
                  "functions": { "type": "integer" },
                  "average_complexity": { "type": "number" },
                  "max_complexity": { "type": "number" },
                  "total_complexity": { "type": "number" }
                }
              }
            },
            "overall_average": { "type": "number" },
            "overall_max": { "type": "number" }
          }
        },
        "dependency_analysis": {
          "type": "object",
          "properties": {
            "has_package_json": { "type": "boolean" },
            "has_requirements_txt": { "type": "boolean" },
            "production_dependencies": { "type": "array", "items": { "type": "string" } },
            "dependency_count": { "type": "integer" }
          }
        },
        "deployment": {
          "type": "object",
          "properties": {
            "method": { "type": "string" },
            "steps_description": { "type": "array", "items": { "type": "string" } },
            "steps_count": { "type": "integer" }
          }
        },
        "dev_time": {
          "type": "object",
          "properties": {
            "wall_clock_minutes": { "type": "number" },
            "wakatime_seconds": { "type": "number" },
            "sessions": { "type": "integer" },
            "source": { "type": "string" }
          }
        },
        "ai_ratio": {
          "type": "object",
          "properties": {
            "ratio": { "type": "number", "minimum": 0, "maximum": 1 },
            "ai_generated_lines": { "type": "integer" },
            "human_written_lines": { "type": "integer" },
            "total_lines": { "type": "integer" },
            "source": { "type": "string" }
          }
        }
      }
    }
  }
}
